version: '3'

services:
  master:
    image: husarion/rosbridge-server:noetic
    command: roslaunch rosbridge_server rosbridge_websocket.launch
    ports:
      - 11311:11311
      - 9090:9090
    restart: unless-stopped
  
  detection:
    build: 
      context: ..
      dockerfile: Dockerfile
    volumes:
      - ..:/workspace:cached
    environment:
      - "ROS_MASTER_URI=http://master:11311"
    command: sleep infinity
    depends_on:
      - master
    network_mode: service:master
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              capabilities: [gpu]
              count: 1